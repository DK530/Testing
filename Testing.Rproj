import pandas as pd
from statsmodels.tsa.statespace.sarimax import SARIMAX

# Load the main data
df = pd.read_excel('main_data.xlsx')

# Load the seasonal, events, and holiday data
df_season_event = pd.read_excel('season_event_data.xlsx')

# Since the seasonal data is on a daily basis, we set the Date as the index
df_season_event.set_index('Date', inplace=True)

# Merge the two datasets. Since the second dataframe is indexed by date, it will fill all hours of the day with the same value
df = df.join(df_season_event, on='Date')

# Create dummy variables for categorical data
df = pd.get_dummies(df, columns=["Season", "Special Events"])

# Make sure that Date and Hour are combined into a single datetime column
df['Datetime'] = pd.to_datetime(df['Date']) + pd.to_timedelta(df['Hour'], unit='h')
df = df.set_index('Datetime')

# Create train and test datasets
size = int(len(df) * 0.7)  # 70% of the data will be for training
train, test = df['Covers'][0:size], df['Covers'][size:len(df)]

# Separate exogenous variables
exog = df[df.columns.difference(['Covers'])]
exog_train, exog_test = exog[0:size], exog[size:len(exog)]

# Fit a SARIMAX model
model = SARIMAX(train, exog=exog_train, order=(1, 1, 1), seasonal_order=(1,1,0,12))
model_fit = model.fit(disp=0)

# Do prediction
prediction = model_fit.predict(start=len(train), end=len(train)+len(test)-1, exog=exog_test)

# Print the prediction
print(prediction)
